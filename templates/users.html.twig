{% extends 'base.html.twig' %}

{% block title %}Users Page{% endblock %}

{% block content %}
<table id="usersID" class="table table-striped table-hover">
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Gender</th>
        <th>Status</th>
        <th colspan="3">Actions</th>
    </tr>
    {% for value in users %}
    <tr id="row-{{value.id}}">
      <td>{{value.id}}</td>
      <td>{{value.name}}</td>
      <td>{{value.email}}</td>
      <td>{{value.gender}}</td>
      <td>{{value.status}}</td>
      <td class="action-td">
        <div class="wrapper">
            <button onclick="show('{{ value.id }}')" class="btn btn-primary">show</button>
            <button onclick="edit('{{value.id}}')" class="btn btn-secondary">edit</button>
            <button onclick="deleteUser('{{value.id}}')" class="btn btn-danger">delete</button>
        </div>
    </td>
    </tr>
    {% endfor %}
</table>

<div class="pagination">
    <a href="?page={{ pagination.page - 1 }}" class="{{pagination.page <=1 ? "disabled" : ""}}" >Previous</a>

  {% for i in 1..pagination.totalPages %}
      <a href="?page={{ i }}" {% if i == pagination.page %}class="active"{% endif %}>{{ i }}</a>
  {% endfor %}
    
    <a href="?page={{ pagination.page + 1 }}" class="{{pagination.page >= pagination.totalPages ? "disabled" : ""}}" >Next</a>
</div>

    <a href="/users/new"><button class="btn">Добавить пользователя</button></a>
    <a href="/find"><button class="btn">Найти пользователя</button></a>

<script>
      function show(value){
        window.location.replace("/show/" + value);
      }
      
      function edit(value){
        window.location.replace("/users/edit/" + value);
      }

      function deleteUser(value){
        fetch(`/users/${value}`, {method: "DELETE"})
        .then((response) => {
            return response.json();
        })
        .then((data) => {
            console.log(data);
            alert(data.message);
            if(data.status == 'success'){
              const row = document.getElementById(`row-${value}`);
              if (row) {
                row.remove();
              }
            }
          })
      }
    </script>
{% endblock %}