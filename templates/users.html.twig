{% extends 'base.html.twig' %}

{% block title %}Users Page{% endblock %}

{% block content %}
<table id="usersID" class="table table-striped table-hover table-bordered">
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Gender</th>
        <th>Status</th>
        <th colspan="3">Actions</th>
    </tr>
    {% for value in users %}
    <tr id="row-{{value.id}}">
      <td>{{value.id}}</td>
      <td>{{value.name}}</td>
      <td>{{value.email}}</td>
      <td>{{value.gender}}</td>
      <td>{{value.status}}</td>
      <td class="action-td">
        <div class="wrapper">
            <button onclick="show('{{ value.id }}')" class="btn btn-primary">show</button>
            <button onclick="edit('{{value.id}}')" class="btn btn-success">edit</button>
            <button onclick="deleteUser('{{value.id}}')" class="btn btn-danger">delete</button>
        </div>
    </td>
    </tr>
    {% endfor %}
</table>

<div class="pagination">

  <ul class="pagination justify-content-center">
    <li class="page-item {{pagination.page <=1 ? "disabled" : ""}}">
      <a href="?page={{ pagination.page - 1 }}" class="page-link" >Previous</a>
    </li>
    

  {% for i in 1..pagination.totalPages %}
    <li class="page-item">
      <a href="?page={{ i }}" class="{% if i == pagination.page %}active{% endif %} page-link">{{ i }}</a>
    </li>
      
  {% endfor %}
    <li class="page-item {{pagination.page >= pagination.totalPages ? "disabled" : ""}}">
      <a href="?page={{ pagination.page + 1 }}" class="page-link" >Next</a>
    </li> 
  </ul>
</div>

    <a href="/users/new"><button class="btn btn-success btn-lg" id="btn-add">Добавить пользователя</button></a>
    <a href="/find"><button class="btn btn-success btn-lg" id="btn-find">Найти пользователя</button></a>

<script>
      function show(value){
        window.location.replace("/show/" + value);
      }
      
      function edit(value){
        window.location.replace("/users/edit/" + value);
      }

      function deleteUser(value){
        fetch(`/users/${value}`, {method: "DELETE"})
        .then((response) => {
            return response.json();
        })
        .then((data) => {
            console.log(data);
            alert(data.message);
            if(data.status == 'success'){
              const row = document.getElementById(`row-${value}`);
              if (row) {
                row.remove();
              }
            }
          })
      }
    </script>
{% endblock %}